
-- Date as YYYY-MM-dd character for sorting -------------------------------------------------------

convert(char(10), JOIN_DATE, 126)

-- Simulate a crosstab in SQL ---------------------------------------------------------------------

-- SUMMARISE THE DATA BY GROUP
; WITH COUNTS AS (
	SELECT DATEPART(YEAR,CHANGE_DATE) AS YEAR, CHANGE_TYPE, COUNT(*) AS COUNTER
	FROM TBL_CHANGES
	GROUP BY DATEPART(YEAR,CHANGE_DATE), CHANGE_TYPE
)

-- MAKE A CROSS-TABULATION WITH EACH YEAR AS COLUMN
SELECT CHANGE_TYPE, 
	'2016' = SUM(CASE WHEN YEAR = 2016 THEN COUNTER ELSE 0 END),
	'2017' = SUM(CASE WHEN YEAR = 2017 THEN COUNTER ELSE 0 END)
FROM COUNTS
GROUP BY CHANGE_TYPE

-- ORDER BY TYPE OF CHANGE
ORDER BY CASE WHEN CHANGE_TYPE = 'JOINED' THEN 1
              WHEN Change_Type='REINSTATED' THEN 2
              WHEN Change_Type='RESIGNED' THEN 3
              WHEN Change_Type='DECEASED' THEN 4
              ELSE 5 END
